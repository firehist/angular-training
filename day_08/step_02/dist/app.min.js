angular.module("chatApplication",["firebase","angular-md5","ui.router","chatApplication.auth","chatApplication.home","chatApplication.channel","chatApplication.user"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/")}]).constant("FirebaseURL","https://ngtraining.firebaseio.com/"),angular.module("chatApplication.auth",["firebase","angular-md5","ui.router"]).config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"modules/auth/login.html",controller:"authController as authCtrl",resolve:{requireNoAuth:["$state","authService",function(a,b){return b.$requireAuth().then(function(b){a.go("home")},function(a){})}]}}).state("register",{url:"/register",templateUrl:"modules/auth/register.html",controller:"authController as authCtrl",resolve:{requireNoAuth:["$state","authService",function(a,b){return b.$requireAuth().then(function(b){a.go("home")},function(a){})}]}})}]),angular.module("chatApplication.auth").controller("authController",["$q","$state","authService",function(a,b,c){var d=this,e=["twitter","github"];d.user={},d.login=function(){return c.$authWithPassword(d.user).then(function(a){b.go("channels")},function(a){d.error=a})},d.loginWithOauth=function(f){return-1===e.indexOf(f)?a.reject("This provider isn't allowed"):c.$authWithOAuthPopup(f).then(function(a){b.go("channels")})["catch"](function(a){d.error=a})},d.register=function(){Auth.$createUser(d.user).then(function(a){d.login()},function(a){d.error=a})}}]),angular.module("chatApplication.auth").factory("authService",["$firebaseAuth","FirebaseURL",function(a,b){var c=new Firebase(b),d=a(c);return d}]),angular.module("chatApplication.channel",["firebase","ui.router"]).config(["$stateProvider",function(a){a.state("channels",{url:"/channels",templateUrl:"modules/channel/channelIndex.html",controller:"channelIndexController as channelIndexCtrl",resolve:{channels:["channelService",function(a){return a.$loaded()}],profile:["$state","authService","userService",function(a,b,c){return b.$requireAuth().then(function(b){return c.getProfile(b.uid).$loaded().then(function(b){return b.displayName?b:void a.go("user")})},function(b){a.go("home")})}]}}).state("channels.create",{url:"/create",templateUrl:"modules/channel/channelCreate.html",controller:"channelCreateController as channelCreateCtrl"}).state("channels.messages",{url:"/{channelId}/messages",templateUrl:"modules/channel/channelMessage.html",controller:"channelMessageController as channelMessageCtrl",resolve:{messages:["Messages","$stateParams",function(a,b){return a.forChannel(b.channelId).$loaded()}],channelName:["$stateParams","channelService",function(a,b){return b.$loaded().then(function(c){return"#"+b.$getRecord(a.channelId).name})}]}})}]),angular.module("chatApplication.channel").controller("channelCreateController",["$state","channels",function(a,b){var c=this;c.channels=b,c.newChannel={name:""},c.createChannel=function(){c.channels.$add(c.newChannel).then(function(a){c.newChannel.name=""})}}]),angular.module("chatApplication.channel").controller("channelIndexController",["$state","authService","userService","profile","channels",function(a,b,c,d,e){var f=this;f.profile=d,f.channels=e,f.getDisplayName=c.getDisplayName,f.getGravatar=c.getGravatar,f.logout=function(){b.$unauth(),a.go("home")}}]),angular.module("chatApplication.channel").controller("channelMessageController",["profile","messages","channelName",function(a,b,c){var d=this;d.channelName=c,d.messages=b,d.message="",d.sendMessage=function(){d.message.length>0&&d.messages.$add({uid:a.$id,body:d.message,timestamp:Firebase.ServerValue.TIMESTAMP}).then(function(){d.message=""})}}]),angular.module("chatApplication.channel").factory("Messages",["$firebaseArray","FirebaseURL",function(a,b){var c=new Firebase(b+"/channelMessages"),d={forChannel:function(b){return a(c.child(b))}};return d}]),angular.module("chatApplication.channel").factory("channelService",["FirebaseURL","$firebaseArray","Firebase",function(a,b,c){var d=new c(a+"/channels"),e=b(d);return e}]),angular.module("chatApplication.home",["firebase","angular-md5","ui.router"]).config(["$stateProvider",function(a){a.state("home",{url:"/",templateUrl:"modules/home/home.html",resolve:{profile:["$state","userService","authService",function(a,b,c){return c.$requireAuth().then(function(c){return b.getProfile(c.uid).$loaded().then(function(b){return a.go("channels"),b})},function(b){a.go("login")})}]}})}]),angular.module("chatApplication.user",["ui.router"]).config(["$stateProvider",function(a){a.state("user",{url:"/user",templateUrl:"modules/user/user.html",controller:"userController as userCtrl",resolve:{auth:["$state","userService","authService",function(a,b,c){return c.$requireAuth()["catch"](function(){a.go("home")})}],profile:["userService","authService",function(a,b){return b.$requireAuth().then(function(b){return a.getProfile(b.uid).$loaded()})}]}})}]),angular.module("chatApplication.user").controller("UserCtrl",["$state","userService","profile","auth","md5",function(a,b,c,d,e){var f=this;f.profile=c,f.gravatar=b.getGravatar(d.uid),f.updateProfile=function(){try{f.profile.emailHash=e.createHash(d.password.email)}catch(b){}f.profile.$save().then(function(){a.go("channels")})}}]),angular.module("chatApplication.user").factory("userService",["$firebaseObject","$firebaseArray","FirebaseURL",function(a,b,c){var d=new Firebase(c+"/users"),e=b(d),f={getProfile:function(b){return a(d.child(b))},getDisplayName:function(a){return e.$getRecord(a).displayName},getGravatar:function(a){var b=e.$getRecord(a);return b&&b.emailHash?"//www.gravatar.com/avatar/"+b.emailHash:""},all:e};return f}]);
//# sourceMappingURL=app.min.js.map